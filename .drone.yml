kind: pipeline
name: app-dashboard

steps:
  - name: 测试构建
    image: node:lts-alpine
    pull: true
    commands:
      - npm i -g npm
      - npm i -g @angular/cli
      - npm install
      - npm run lint
      - npm run build:ci
  - name: 发布部署
    image: plugins/s3
    pull: true
    settings:
      path_style: true
      bucket: app
      access_key:
        from_secret: qn_ak
      secret_key:
        from_secret: qn_sk
      region: cn-south-1
      endpoint: https://s3-cn-south-1.qiniucs.com
      source: dist/**/*
    when:
      branch:
        - master
        - develop
